<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ•‘æ´ç§¦å¾—åƒï¼šè¡Œå‹•ç¤ºç¯„ç‰ˆ</title>
<style>
  /* --- åŸºç¤è¨­å®š --- */
  body { background: #2c3e50; color: white; text-align: center; font-family: "Microsoft JhengHei", sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding-bottom: 20px; -webkit-tap-highlight-color: transparent; }
  
  /* --- é ‚éƒ¨è³‡è¨Šåˆ— (æ‰‹æ©Ÿç‰ˆå„ªåŒ–) --- */
  .info-bar { background: rgba(0,0,0,0.9); width: 100%; padding: 10px 0; display: flex; justify-content: space-around; font-size: 0.9em; position: fixed; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.5); border-bottom: 2px solid #f39c12; }
  .status-box { padding: 5px 8px; border-radius: 5px; background: #34495e; border: 1px solid #555; display: flex; flex-direction: column; align-items: center; }
  .status-val { font-size: 1.2em; font-weight: bold; margin-top: 2px; }
  .highlight-red { color: #ff6b6b; }
  
  h1 { margin-top: 80px; font-size: 1.5em; text-shadow: 2px 2px 4px black; letter-spacing: 1px; width: 90%; }
  
  /* --- å¡ç‰‡å€åŸŸ (RWD è‡ªå‹•æŠ˜è¡Œ) --- */
  .table { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 10px; width: 95%; max-width: 900px; padding-bottom: 120px; /* é ç•™åº•éƒ¨ç©ºé–“çµ¦æ“ä½œå€ */ }
  .target-card { width: 30%; max-width: 130px; aspect-ratio: 2/3; border-radius: 8px; position: relative; box-shadow: 0 2px 10px rgba(0,0,0,0.5); transition: transform 0.3s; pointer-events: none; }
  .target-card img { width: 100%; height: 100%; border-radius: 8px; object-fit: cover; }
  .card-label { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.7); border-radius: 0 0 8px 8px; padding: 3px 0; font-size: 0.8em; z-index: 2; }

  /* --- åº•éƒ¨æ“ä½œå€ (å›ºå®šåœ¨ä¸‹æ–¹ï¼Œæ–¹ä¾¿å–®æ‰‹æ“ä½œ) --- */
  .hand-area { position: fixed; bottom: 0; width: 100%; background: rgba(44, 62, 80, 0.95); padding: 15px; border-radius: 20px 20px 0 0; box-shadow: 0 -4px 15px rgba(0,0,0,0.5); border-top: 1px solid rgba(255,255,255,0.1); z-index: 90; display: flex; flex-direction: column; align-items: center; box-sizing: border-box; }
  
  .btn { padding: 12px 0; width: 90%; font-size: 1.2em; background: linear-gradient(to right, #e67e22, #d35400); color: white; border: none; cursor: pointer; border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-weight: bold; transition: transform 0.1s; }
  .btn:active { transform: scale(0.96); }
  .btn:disabled { background: #7f8c8d; }

  /* --- äº‹ä»¶å½ˆçª— (æ‰‹æ©Ÿç‰ˆå„ªåŒ–) --- */
  .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 200; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
  .event-card { background: #222; width: 85%; max-width: 400px; border-radius: 15px; padding: 20px; border: 2px solid #555; text-align: center; position: relative; animation: popUp 0.3s ease-out; box-shadow: 0 10px 25px rgba(0,0,0,0.8); }
  
  .state-emergency { border-color: #c0392b; background: #2c0b0b; }
  
  .event-img { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 15px; border: 1px solid #444; }
  .event-title { font-size: 1.4em; color: #f1c40f; margin-bottom: 10px; font-weight: bold; }
  .event-desc { font-size: 1em; line-height: 1.5; color: #ddd; margin-bottom: 15px; text-align: left; }
  .close-btn { background: #3498db; color: white; border: none; padding: 10px 30px; border-radius: 50px; font-size: 1em; cursor: pointer; width: 100%; }

  @keyframes popUp { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

  /* --- çµå±€å½ˆçª— --- */
  .end-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 300; flex-direction: column; align-items: center; justify-content: center; padding: 30px; box-sizing: border-box; }
  .end-modal h2 { font-size: 2em; margin-bottom: 20px; }
  .end-modal p { font-size: 1.1em; line-height: 1.6; color: #ccc; max-width: 500px; }
  .win-text { color: #2ecc71; }
  .lose-text { color: #e74c3c; }

</style>
</head>
<body>

  <div class="info-bar">
    <div class="status-box"><div>â³ å›åˆ</div><div id="turn-count" class="status-val highlight-red">20</div></div>
    <div class="status-box"><div>ğŸš¨ è­¦å ±</div><div id="next-crisis" class="status-val">3</div></div>
    <div class="status-box"><div>â¤ï¸ é€²åº¦</div><div class="status-val"><span id="progress-count">0</span>/5</div></div>
  </div>

  <h1>æ•‘æ´ç§¦å¾—åƒ</h1>

  <div class="table">
    <div class="target-card"><img id="img0" src="bad1.jpeg"><div class="card-label">ç¶“æ¿Ÿ</div></div>
    <div class="target-card"><img id="img1" src="bad2.jpeg"><div class="card-label">å¥åº·</div></div>
    <div class="target-card"><img id="img2" src="bad3.jpeg"><div class="card-label">æƒ…æ„Ÿ</div></div>
    <div class="target-card"><img id="img3" src="bad4.jpeg"><div class="card-label">æ€§åˆ¥</div></div>
    <div class="target-card"><img id="img4" src="bad5.jpeg"><div class="card-label">å°Šåš´</div></div>
  </div>

  <div class="hand-area">
    <button id="draw-btn" class="btn" onclick="playTurn()">ğŸ”® æ¢ç´¢å‘½é‹ (æŠ½ç‰Œ)</button>
  </div>

  <div id="event-modal" class="modal-overlay">
    <div id="event-card-box" class="event-card">
      <h3 id="event-title" class="event-title">æ¨™é¡Œ</h3>
      <img id="event-img" class="event-img" src="">
      <p id="event-desc" class="event-desc">å…§å®¹</p>
      <div id="effect-container" style="margin-bottom:15px; text-align:left;"></div>
      <button class="close-btn" onclick="closeEvent()">ç¢ºèª</button>
    </div>
  </div>

  <div id="end-modal" class="end-modal">
    <h2 id="end-title"></h2>
    <p id="end-desc"></p>
    <button class="btn" style="margin-top:20px;" onclick="location.reload()">ğŸ”„ é‡æ–°æŒ‘æˆ°</button>
  </div>

<script>
  // è³‡æ–™åº« (å¯è‡ªè¡Œæ“´å……)
  const normalEvents = [
    { type: 'good', target: 0, title: "è³£èœç”Ÿæ„ä½³", desc: "é‹æ°£ä¸éŒ¯ï¼Œè³ºäº†ä¸€å¡Šå¤šéŒ¢ï¼Œçµ‚æ–¼å¯ä»¥ç³´äº›ç±³å›å®¶äº†ã€‚", img: "card1.jpeg" },
    { type: 'good', target: 2, title: "è¦ªæƒ…çš„æº«æš–", desc: "ç²å¾—è¦ªæˆšæ”¯æ´çš„é‡‘èŠ±ä¸€æ”¯ï¼Œé›ªä¸­é€ç‚­çš„æº«æš–ã€‚", img: "card2.jpeg" },
    { type: 'good', target: 1, title: "ç©¿è¶Šï¼šç˜§ç–¾æ ¹é™¤", desc: "ã€ç¾ä»£é†«ç™‚ã€‘æ™‚ç©ºç©¿è¶Šï¼å°ç£é†«ç™‚é€²æ­¥ï¼Œç˜§ç–¾ä¸å†æ˜¯çµ•ç—‡ã€‚", img: "card6.jpeg" },
    { type: 'bad', target: 4, title: "æ­·å²ï¼šå·¡è­¦è¾±ç½µ", desc: "ã€Œç•œç”Ÿï¼ã€ç„¡ç†çš„å·¡è­¦åœ¨è¡—é ­å…¬ç„¶ç¾è¾±ï¼Œé€™æ˜¯æ®–æ°‘é«”åˆ¶ä¸‹æœ€èµ¤è£¸çš„æš´åŠ›ã€‚", img: "card3.jpeg" },
    { type: 'bad', target: 0, title: "æ­·å²ï¼šåº¦é‡è¡¡æ”¹æ­£", desc: "æ–°çš„åº¦é‡è¡¡è¦å‰‡å¯¦æ–½ï¼ŒèˆŠçš„ç¨±ä»”è¢«æ²’æ”¶ï¼Œç”Ÿè¨ˆæ–·çµ•ã€‚", img: "card5.jpeg" },
    { type: 'bad', target: 0, title: "ç•¶ä»£ï¼šç§»å·¥ä»²ä»‹å‚µå‹™", desc: "ã€ç§»å·¥è­°é¡Œã€‘èƒŒè² å·¨é¡ä»²ä»‹è²»ï¼Œå·¥ä½œå‰å…©å¹´å¹¾ä¹éƒ½åœ¨é‚„å‚µã€‚", img: "card1.jpeg" },
    { type: 'bad', target: 3, title: "ç•¶ä»£ï¼šè·å ´å¤©èŠ±æ¿", desc: "ã€æ€§åˆ¥å¹³æ¬Šã€‘å¥³æ€§åœ¨è·å ´å‡é·ä»é¢è‡¨éš±å½¢é˜»ç¤™ã€‚", img: "card5.jpeg" }
  ];

  const stateEvents = [
    { type: 'bad', target: [0, 1], title: "âš ï¸ å¼·çƒˆåœ°éœ‡", desc: "çªç™¼å¼·éœ‡è¥²æ“Šï¼æˆ¿å±‹å€’å¡Œï¼ŒåŸºç¤å»ºè¨­å—æï¼Œäººæ°‘é¢è‡¨ç”Ÿå­˜è€ƒé©—ã€‚", img: "card4.jpeg" },
    { type: 'bad', target: [4, 2], title: "âš ï¸ å®£ä½ˆæˆ’åš´", desc: "æ”¿åºœä»¥åœ‹å®¶å®‰å…¨ç‚ºç”±å®£ä½ˆæˆ’åš´ï¼Œç¦æ­¢é›†æœƒçµç¤¾ã€‚ç¤¾æœƒæ°›åœè‚…æ®ºã€‚", img: "card3.jpeg" },
    { type: 'bad', target: [0], title: "âš ï¸ ç¶“æ¿Ÿææ…Œ", desc: "å—åˆ°ä¸–ç•Œå±€å‹¢å½±éŸ¿ï¼Œç‰©åƒ¹é£›æ¼²ï¼Œè²¨å¹£è²¶å€¼ã€‚å¤±æ¥­ç‡é£†å‡ã€‚", img: "card5.jpeg" }
  ];

  let maxTurns = 20;
  let currentTurn = maxTurns;
  let status = [false, false, false, false, false]; 
  let gameActive = true;
  let triggerInterval = 3; 

  function updateInfo() {
    let progress = status.filter(Boolean).length;
    document.getElementById("progress-count").innerText = progress;
    document.getElementById("turn-count").innerText = currentTurn;
    let turnsPlayed = maxTurns - currentTurn;
    let turnsUntilCrisis = triggerInterval - (turnsPlayed % triggerInterval);
    if (turnsPlayed > 0 && turnsPlayed % triggerInterval === 0) turnsUntilCrisis = 3;
    document.getElementById("next-crisis").innerText = turnsUntilCrisis;
  }

  function flipCard(id, makeGood) {
    status[id] = makeGood;
    let img = document.getElementById("img" + id);
    let fileNum = id + 1; 
    img.src = (makeGood ? "good" : "bad") + fileNum + ".jpeg";
  }

  function playTurn() {
    if(!gameActive) return;
    currentTurn--;
    let turnsPlayed = maxTurns - currentTurn;
    let evt = null;
    let isStateEvent = false;

    if (turnsPlayed > 0 && turnsPlayed % triggerInterval === 0) {
        let randIndex = Math.floor(Math.random() * stateEvents.length);
        evt = stateEvents[randIndex];
        isStateEvent = true;
    } else {
        let randIndex = Math.floor(Math.random() * normalEvents.length);
        evt = normalEvents[randIndex];
    }

    // é¡¯ç¤ºäº‹ä»¶å½ˆçª—
    let modal = document.getElementById("event-modal");
    let cardBox = document.getElementById("event-card-box");
    
    if(isStateEvent) cardBox.classList.add("state-emergency");
    else cardBox.classList.remove("state-emergency");

    document.getElementById("event-img").src = evt.img;
    document.getElementById("event-title").innerText = evt.title;
    document.getElementById("event-desc").innerText = evt.desc;
    
    // è™•ç†æ•ˆæœ
    let container = document.getElementById("effect-container");
    container.innerHTML = "";
    
    let targets = Array.isArray(evt.target) ? evt.target : [evt.target];
    let targetNames = ["ç¶“æ¿Ÿ","å¥åº·","æƒ…æ„Ÿ","æ€§åˆ¥","å°Šåš´"];

    targets.forEach(targetIndex => {
        let span = document.createElement("div");
        span.style.padding = "5px";
        span.style.marginBottom = "5px";
        span.style.borderRadius = "4px";
        
        if (evt.type === 'good') {
            if (!status[targetIndex]) {
                flipCard(targetIndex, true);
                span.innerText = "âœ¨ " + targetNames[targetIndex] + " æ•‘æ´æˆåŠŸï¼";
                span.style.background = "#27ae60";
            } else {
                span.innerText = "ğŸ‘Œ " + targetNames[targetIndex] + " ç¶­æŒè‰¯å¥½";
                span.style.background = "#555";
            }
        } else {
            if (status[targetIndex]) {
                flipCard(targetIndex, false);
                span.innerText = "ğŸ’¥ " + targetNames[targetIndex] + " é­å—é‡å‰µï¼";
                span.style.background = "#c0392b";
            } else {
                span.innerText = "ğŸ˜° " + targetNames[targetIndex] + " æŒçºŒæƒ¡åŒ–";
                span.style.background = "#555";
            }
        }
        container.appendChild(span);
    });

    modal.style.display = "flex";
  }

  function closeEvent() {
    document.getElementById("event-modal").style.display = "none";
    updateInfo();
    checkGameOver();
  }

  function checkGameOver() {
    let progress = status.filter(Boolean).length;
    if (progress === 5) showEnd(true);
    else if (currentTurn <= 0) showEnd(false);
  }

  function showEnd(isWin) {
    gameActive = false;
    let modal = document.getElementById("end-modal");
    modal.style.display = "flex";
    let title = document.getElementById("end-title");
    let desc = document.getElementById("end-desc");
    
    if(isWin) {
      title.innerText = "ğŸ‰ æ•‘æ´æˆåŠŸï¼";
      title.className = "win-text";
      desc.innerText = "åœ¨ä½ çš„åŠªåŠ›ä¸‹ï¼Œç§¦å¾—åƒç²å¾—äº†å°Šåš´ã€‚";
    } else {
      title.innerText = "ğŸ¥€ ä»»å‹™å¤±æ•—";
      title.className = "lose-text";
      desc.innerText = "æ™‚ä»£çš„æ´ªæµå¤ªéç„¡æƒ…...ä½†è«‹ä¸è¦æ”¾æ£„å¸Œæœ›ã€‚";
    }
  }

  updateInfo();
</script>
</body>
</html>
